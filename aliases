#!/bin/bash
alias toClipBoard="xclip -i -selection clipboard"
alias ssh="ssh -v"
alias dc="docker-compose"
alias dcb="docker-compose -f docker-compose-build.yml"
alias dcd="docker-compose -f docker-compose-dev.yml"
alias dce="docker-compose -f docker-compose-experiment.yml"
alias workspace="cd ~/workspace"
alias ws="cd ~/workspace"
alias rl="cd ~/workspace/rl-app"
alias persona="cd ~/workspace/persona-server"
alias dockerRmDiffs="sudo service docker stop; sudo rm -rf /var/lib/docker/aufs/diff; sudo service docker start"
alias dockerStopAll="docker stop \$(docker ps -a -q)";
alias dockerRmAll="docker rm \$(docker ps -a -q)";
alias dockerRmVolumes="docker volume rm \`docker volume ls -q -f dangling=true\`"
alias dockerRmConsul="sudo rm -rf /consul/*"
alias dockerRmDanglingImages="docker rmi \$(docker images -aq --filter dangling=true)"
alias dockerCleanUp="dockerRmConsul; dockerStopAll; dockerRmAll; dockerRmVolumes; dockerRmDanglingImages; docker network prune; dockerRmDiffs"
alias listLargeFiles="sudo du -h / 2>/dev/null | grep '[0-9\.]\+G'"
alias startDocker="sudo service docker start"
alias gcob="git checkout -b"
alias gco="git checkout"
alias gcot="git checkout --theirs"
alias gom="git checkout master; git pull origin master"
alias gma="git rebase --abort";
alias gpo="branchName=\`git rev-parse --abbrev-ref HEAD\`; git push origin \$branchName";
alias grm="branchName=\`git rev-parse --abbrev-ref HEAD\`; gpo; gom; git checkout \$branchName; git rebase -i master";
alias gpu="branchName=\`git rev-parse --abbrev-ref HEAD\`; git pull origin \$branchName";
alias gst="git status"
alias gd="git diff"
alias gau="git add -u"
alias ga="git add"
alias gai="git add -i"
alias gc="git commit"
alias gss="git stash save"
alias gsp="git stash pop"
alias gsa="git stash apply"
alias gp="branchName=\`git rev-parse --abbrev-ref HEAD\`; git pull origin \$branchName;"
alias grc="git rebase --continue"
alias gra="git rebase --abort"
alias gr="git reset ."
alias grh="git reset HEAD "
alias gruf="git clean -fd"
alias ghr="branchName=\`git rev-parse --abbrev-ref HEAD\`; git fetch origin; git reset --hard \$branchName"
alias aliases="cat ~/.aliases"
alias gitPassword="secret-tool search --all unique ssh-store:/home/smoky/.ssh/github_rsa 2>/dev/null | awk ' /secret =/ { print \$3; exit; } ' | toClipBoard; ssh-add ~/.ssh/github_rsa"
alias runTests="dc -f docker-compose-dev.yml run test"
alias runRedis="docker run --name redis -p 6379:6379 -d redis:3.0.7"
alias cleanDNS="sudo /etc/init.d/dns-clean restart; sudo systemd-resolve --flush-caches";
alias useLocalDNS="echo \"nameserver 127.0.0.1\" | sudo tee /etc/resolv.conf > /dev/null; cleanDNS"
alias useAWSDNS="echo \"nameserver 172.16.0.23\" | sudo tee /etc/resolv.conf > /dev/null; cleanDNS"
alias changeHosts="sudo vim /etc/hosts"
alias reloadSource="source ~/.zshrc"
alias colours="for i in {0..255}; do printf \"\\x1b[38;5;\${i}mcolour\${i}\\x1b[0m \"; done";
alias startVBoxService="sudo systemctl start vboxdrv.service"
alias ..="cd .."
alias restartTrackpad="sudo rmmod bcm5974 && sudo modprobe bcm5974"

function currentBranch() {
    echo `git rev-parse --abbrev-ref HEAD`
}

function selectLoginProd() {
    export LOGIN_CONFIG_SECRET=$LOGIN_CONFIG_STAGING_SECRET
}

function selectLoginStaging() {
    export LOGIN_CONFIG_SECRET=$LOGIN_CONFIG_STAGING_SECRET
}

function selectLoginLocal() {
    export LOGIN_CONFIG_SECRET=$LOGIN_CONFIG_LOCAL_SECRET
}

function decryptProvider() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    cat providers.ini.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret > providers.ini
}

function encryptProvider() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    cat providers.ini | docker run -i talis/nema:latest /nema -encrypt -key $secret > providers.ini.enc
}

function diffProviders() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    branch=`currentBranch`
    x=`cat providers.ini.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret`
    gco master >/dev/null 2>&1
    gpo >/dev/null 2>&1
    y=`cat providers.ini.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret`
    gco $branch >/dev/null 2>&1
    diff <(echo $x) <(echo $y)
}

function decryptIdps() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    cat idps.json.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret > idps.json
}

function encryptIdps() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    cat idps.json | docker run -i talis/nema:latest /nema -encrypt -key $secret > idps.json.enc
}

function diffIdps() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    branch=`currentBranch`
    x=`cat idps.json.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret`
    gco master >/dev/null 2>&1
    gpo >/dev/null 2>&1
    y=`cat idps.json.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret`
    gco $branch >/dev/null 2>&1
    diff <(echo $x) <(echo $y)
}

function decryptFederations() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    cat federations.json.enc | docker run -i talis/nema:latest /nema -decrypt -key $secret > federations.json
}

function encryptFederations() {
    secret=${LOGIN_CONFIG_SECRET:-$LOGIN_CONFIG_PROD_SECRET}
    cat federations.json| docker run -i talis/nema:latest /nema -encrypt -key $secret > federations.json.enc
}

function prod_aws_keys() {
    export AWS_ACCESS_KEY_ID=$PROD_AWS_ACCESS_KEY_ID
    export AWS_SECRET_ACCESS_KEY=$PROD_AWS_SECRET_ACCESS_KEY
}

function stag_aws_keys() {
    source ~/.security
}
